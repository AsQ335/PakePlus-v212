# 快速开始指南

## 一键集成（推荐）

### 步骤 1：备份原文件

```bash
cd PakePlus-v212
copy src-tauri\data\custom.js src-tauri\data\custom.js.backup
```

### 步骤 2：替换脚本

```bash
copy s1-基础功能\onechat-custom.js src-tauri\data\custom.js
```

### 步骤 3：测试

开发模式测试：

```bash
pnpm install
pnpm run tauri:dev
```

在打开的窗口中：
1. 右键点击页面，选择"检查"打开开发者工具
2. 查看控制台日志，确认脚本正常运行
3. 访问 lmarena.ai 相关页面，验证功能

### 步骤 4：构建

```bash
pnpm run tauri:build
```

构建完成后，可执行文件位于：
- Windows: `src-tauri\target\release\*.exe`
- Mac: `src-tauri/target/release/bundle/macos/*.app`
- Linux: `src-tauri/target/release/bundle/deb/*.deb`

## 功能验证清单

访问目标网站后，在控制台检查以下内容：

### ✅ 基础功能
- [ ] 看到 `[OneChat] 统一注入脚本开始执行` 日志
- [ ] 看到 `[OneChat-Manager] === 初始化完成 ===` 日志
- [ ] 链接点击正常（不会打开新窗口）

### ✅ 域名替换
- [ ] 页面中的 `lmarena.ai` 被替换为 `onechat.ai`
- [ ] 看到 `[OneChat-DomainReplace] lmarena.ai -> onechat.ai` 日志

### ✅ 页面修改
- [ ] 顶部横幅被隐藏
- [ ] 主标题显示为 OneChat Logo（渐变色）
- [ ] 副标题被删除
- [ ] 输入框的爱心按钮被删除

### ✅ 防闪现
- [ ] 页面加载时没有看到原始内容闪现
- [ ] 看到 `[OneChat-AntiFlash] 已临时隐藏页面` 日志
- [ ] 看到 `[OneChat-AntiFlash] 已显示页面内容` 日志

## 配置调整

如果需要调整功能，编辑 `src-tauri/data/custom.js` 中的 `GLOBAL_CONFIG`：

```javascript
const GLOBAL_CONFIG = {
  verbose: true,                    // 改为 false 关闭详细日志
  enableDomainReplacement: true,    // 改为 false 禁用域名替换
  enablePageModifications: true,    // 改为 false 禁用页面修改
  enableAntiFlash: true,            // 改为 false 禁用防闪现
  antiFlashDelay: 200,              // 调整延迟时间（毫秒）
  enableMutationObserver: true,     // 改为 false 禁用持续监听
  enablePeriodicCheck: true,        // 改为 false 禁用定期检查
  periodicCheckInterval: 100,       // 调整检查间隔（毫秒）
};
```

修改后需要重新构建：

```bash
pnpm run tauri:build
```

## 常见问题

### Q1: 脚本没有执行？

**检查步骤：**
1. 确认文件已正确替换：`type src-tauri\data\custom.js`
2. 确认文件开头包含 `PakePlus + OneChat 统一注入脚本`
3. 重新构建项目

### Q2: 域名没有被替换？

**可能原因：**
1. 域名是通过 JavaScript 动态生成的
2. 域名在 iframe 中（需要单独处理）
3. 域名在 Shadow DOM 中

**解决方法：**
- 增加 `periodicCheckInterval` 的频率
- 在控制台手动执行：`window.OneChat.applyAll()`

### Q3: 页面出现闪现？

**解决方法：**
1. 增加 `antiFlashDelay` 的值（如改为 300）
2. 确保 `enableAntiFlash` 为 `true`

### Q4: 如何添加新的域名替换？

编辑 `src-tauri/data/custom.js`，找到 `domainMapping`：

```javascript
domainMapping: {
  'lmarena.ai': 'onechat.ai',
  '2captcha.com': 'onechat.ai',
  'example.com': 'mysite.com'  // 添加新的映射
}
```

### Q5: 如何禁用某个页面修改功能？

在对应的功能函数中直接返回 `false`，例如禁用横幅隐藏：

```javascript
hideBanner() {
  return false;  // 直接返回，不执行任何操作
}
```

## 调试技巧

### 查看所有日志

```javascript
// 在控制台执行
window.OneChat.config.verbose = true
```

### 手动触发修改

```javascript
// 手动应用所有修改
window.OneChat.applyAll()

// 手动替换域名
window.OneChat.domainReplace.replaceAllText()

// 手动应用页面修改
window.OneChat.pageMod.applyAll()
```

### 查看配置

```javascript
// 查看当前配置
console.log(window.OneChat.config)

// 查看域名映射
console.log(window.OneChat.domainReplace.domainMapping)
```

### 临时禁用功能

```javascript
// 禁用域名替换
window.OneChat.config.enableDomainReplacement = false

// 禁用页面修改
window.OneChat.config.enablePageModifications = false

// 禁用防闪现
window.OneChat.config.enableAntiFlash = false
```

## 恢复原始配置

如果需要恢复 PakePlus 原始配置：

```bash
copy src-tauri\data\custom.js.backup src-tauri\data\custom.js
pnpm run tauri:build
```

## 技术支持

如遇到问题，请提供以下信息：

1. 操作系统和版本
2. PakePlus 版本
3. 控制台完整日志
4. 问题截图
5. 访问的目标网站 URL

## 下一步

- 查看 [README.md](./README.md) 了解详细的集成说明
- 查看 [配置说明.md](./配置说明.md) 了解高级配置选项
- 查看原始脚本 [onechat-preload.js](../../s1-项目脚本整合/onechat-preload.js) 了解实现细节
