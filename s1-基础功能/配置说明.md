# 配置说明

## 全局配置项

所有配置项位于 `src-tauri/data/custom.js` 文件的 `GLOBAL_CONFIG` 对象中。

### 基础配置

#### verbose（详细日志）

```javascript
verbose: true  // 默认值：true
```

- **作用**：控制是否输出详细的调试日志
- **建议**：
  - 开发/测试阶段：`true`
  - 生产环境：`false`（减少日志输出，提升性能）

#### enableDomainReplacement（域名替换）

```javascript
enableDomainReplacement: true  // 默认值：true
```

- **作用**：启用/禁用域名文本替换功能
- **影响**：
  - `true`：页面中的域名会被替换（如 lmarena.ai → onechat.ai）
  - `false`：保持原始域名不变

#### enablePageModifications（页面修改）

```javascript
enablePageModifications: true  // 默认值：true
```

- **作用**：启用/禁用页面元素修改功能
- **影响**：
  - `true`：执行 Logo 替换、横幅隐藏、按钮删除等操作
  - `false`：保持页面原始样式

### 防闪现配置

#### enableAntiFlash（防闪现机制）

```javascript
enableAntiFlash: true  // 默认值：true
```

- **作用**：在页面加载时临时隐藏内容，防止原始内容闪现
- **原理**：通过设置 `body { opacity: 0 }` 临时隐藏页面
- **建议**：
  - 如果页面加载很快，可以设为 `false`
  - 如果看到闪现，保持 `true`

#### antiFlashDelay（防闪现延迟）

```javascript
antiFlashDelay: 200  // 默认值：200（毫秒）
```

- **作用**：控制页面隐藏后多久显示
- **调整建议**：
  - 页面简单、加载快：`100-150ms`
  - 页面复杂、加载慢：`200-300ms`
  - 网络较慢：`300-500ms`

### 持久化监听配置

#### enableMutationObserver（DOM 变化监听）

```javascript
enableMutationObserver: true  // 默认值：true
```

- **作用**：监听 DOM 变化，自动处理新添加的内容
- **适用场景**：
  - 单页应用（SPA）
  - 动态加载内容的页面
  - 无限滚动页面
- **性能影响**：中等（持续监听 DOM 变化）

#### enablePeriodicCheck（定期检查）

```javascript
enablePeriodicCheck: true  // 默认值：true
```

- **作用**：定期检查页面，重新应用修改
- **适用场景**：
  - 内容频繁更新的页面
  - MutationObserver 无法捕获的变化
- **性能影响**：低到中等（取决于检查频率）

#### periodicCheckInterval（检查间隔）

```javascript
periodicCheckInterval: 100  // 默认值：100（毫秒）
```

- **作用**：控制定期检查的频率
- **调整建议**：
  - 内容更新频繁：`50-100ms`
  - 内容更新较慢：`200-500ms`
  - 静态页面：`1000ms` 或禁用
- **性能影响**：间隔越短，性能影响越大

## 域名映射配置

### domainMapping（域名映射表）

```javascript
domainMapping: {
  'lmarena.ai': 'onechat.ai',
  '2captcha.com': 'onechat.ai'
}
```

#### 添加新的域名映射

```javascript
domainMapping: {
  'lmarena.ai': 'onechat.ai',
  '2captcha.com': 'onechat.ai',
  'example.com': 'mysite.com',      // 添加新映射
  'api.example.com': 'api.mysite.com'  // 支持子域名
}
```

#### 注意事项

1. **大小写不敏感**：替换时会忽略大小写
2. **完整匹配**：只替换完整的域名，不会替换部分匹配
3. **正则转义**：域名中的 `.` 会自动转义为 `\.`

## 品牌样式配置

### Logo 样式

在 `BrandStylesModule` 中配置：

```javascript
const BrandStylesModule = {
  // 大尺寸 Logo（32px）
  oneChatLogoLarge: `
    <span style="font-size: 32px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; display: inline-block;">
      OneChat
    </span>
  `,
  
  // 中等尺寸 Logo（20px）
  oneChatLogoMedium: `...`,
  
  // 小尺寸 Logo（14px）
  oneChatLogoSmall: `...`,
  
  // 品牌颜色
  colors: {
    gradientStart: '#667eea',
    gradientEnd: '#764ba2',
    primary: '#667eea',
    primaryDark: '#764ba2'
  }
};
```

#### 自定义 Logo

修改 Logo 文本：

```javascript
oneChatLogoLarge: `
  <span style="...">
    YourBrand  // 修改这里
  </span>
`
```

修改 Logo 颜色：

```javascript
// 修改渐变色
background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);

// 或使用纯色
background: #667eea;
```

修改 Logo 大小：

```javascript
font-size: 40px;  // 调整字体大小
```

## 页面修改配置

### 自定义修改规则

在 `PageModificationsModule` 中添加新的修改函数：

```javascript
const PageModificationsModule = {
  // ... 现有功能 ...
  
  /**
   * 自定义功能：隐藏页脚
   */
  hideFooter() {
    return safeExecute('PageMod', '隐藏页脚', () => {
      const footer = document.querySelector('footer');
      if (footer) {
        footer.style.display = 'none';
        return true;
      }
      return false;
    });
  },
  
  /**
   * 自定义功能：修改按钮文本
   */
  changeButtonText() {
    return safeExecute('PageMod', '修改按钮文本', () => {
      const button = document.querySelector('button.submit');
      if (button) {
        button.textContent = '提交';
        return true;
      }
      return false;
    });
  },
  
  applyAll() {
    log('PageMod', '开始应用页面修改');

    const results = {
      banner: this.hideBanner(),
      mainTitle: this.replaceMainTitle(),
      subtitle: this.removeSubtitle(),
      loveButton: this.removeLoveButton(),
      footer: this.hideFooter(),           // 添加新功能
      buttonText: this.changeButtonText()  // 添加新功能
    };

    // ... 其余代码 ...
  }
};
```

### 修改检测规则

在 `needsReapply()` 中添加新的检测逻辑：

```javascript
needsReapply() {
  // ... 现有检测 ...
  
  // 检查页脚
  const footer = document.querySelector('footer');
  if (footer && footer.style.display !== 'none') {
    return true;
  }
  
  return false;
}
```

## 性能优化配置

### 场景 1：静态页面

```javascript
const GLOBAL_CONFIG = {
  verbose: false,
  enableDomainReplacement: true,
  enablePageModifications: true,
  enableAntiFlash: true,
  antiFlashDelay: 150,
  enableMutationObserver: false,  // 禁用
  enablePeriodicCheck: false,     // 禁用
  periodicCheckInterval: 1000
};
```

### 场景 2：动态页面（SPA）

```javascript
const GLOBAL_CONFIG = {
  verbose: false,
  enableDomainReplacement: true,
  enablePageModifications: true,
  enableAntiFlash: true,
  antiFlashDelay: 200,
  enableMutationObserver: true,   // 启用
  enablePeriodicCheck: true,      // 启用
  periodicCheckInterval: 200      // 适中频率
};
```

### 场景 3：高频更新页面

```javascript
const GLOBAL_CONFIG = {
  verbose: false,
  enableDomainReplacement: true,
  enablePageModifications: true,
  enableAntiFlash: true,
  antiFlashDelay: 200,
  enableMutationObserver: true,
  enablePeriodicCheck: true,
  periodicCheckInterval: 50       // 高频检查
};
```

### 场景 4：低性能设备

```javascript
const GLOBAL_CONFIG = {
  verbose: false,
  enableDomainReplacement: true,
  enablePageModifications: true,
  enableAntiFlash: false,         // 禁用防闪现
  antiFlashDelay: 0,
  enableMutationObserver: true,
  enablePeriodicCheck: false,     // 禁用定期检查
  periodicCheckInterval: 500
};
```

## 高级配置

### 条件性启用功能

根据 URL 启用不同的功能：

```javascript
const ExecutionManager = {
  init() {
    const url = window.location.href;
    
    // 根据 URL 调整配置
    if (url.includes('lmarena.ai')) {
      GLOBAL_CONFIG.enablePageModifications = true;
    } else {
      GLOBAL_CONFIG.enablePageModifications = false;
    }
    
    // ... 其余初始化代码 ...
  }
};
```

### 自定义日志级别

```javascript
function log(module, message, type = 'info') {
  // 只输出错误和警告
  if (type !== 'error' && type !== 'warning') return;
  
  // ... 其余日志代码 ...
}
```

### 延迟初始化

```javascript
// 延迟 500ms 后再初始化
setTimeout(() => {
  ExecutionManager.init();
}, 500);
```

## 配置模板

### 最小配置（仅域名替换）

```javascript
const GLOBAL_CONFIG = {
  verbose: false,
  enableDomainReplacement: true,
  enablePageModifications: false,
  enableAntiFlash: false,
  antiFlashDelay: 0,
  enableMutationObserver: true,
  enablePeriodicCheck: false,
  periodicCheckInterval: 100
};
```

### 完整配置（所有功能）

```javascript
const GLOBAL_CONFIG = {
  verbose: true,
  enableDomainReplacement: true,
  enablePageModifications: true,
  enableAntiFlash: true,
  antiFlashDelay: 200,
  enableMutationObserver: true,
  enablePeriodicCheck: true,
  periodicCheckInterval: 100
};
```

### 生产环境配置

```javascript
const GLOBAL_CONFIG = {
  verbose: false,
  enableDomainReplacement: true,
  enablePageModifications: true,
  enableAntiFlash: true,
  antiFlashDelay: 200,
  enableMutationObserver: true,
  enablePeriodicCheck: true,
  periodicCheckInterval: 200
};
```

## 配置验证

修改配置后，在控制台执行以下命令验证：

```javascript
// 查看当前配置
console.table(window.OneChat.config)

// 测试域名替换
window.OneChat.domainReplace.replaceAllText()

// 测试页面修改
window.OneChat.pageMod.applyAll()

// 查看模块状态
console.log('域名替换模块:', window.OneChat.domainReplace)
console.log('页面修改模块:', window.OneChat.pageMod)
```
