# Cloudflare åæ£€æµ‹åŠŸèƒ½è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°åœ¨ OneChat è„šæœ¬ä¸­é›†æˆäº†å®Œæ•´çš„ Cloudflare åæ£€æµ‹æ¨¡å—ï¼Œä½¿åº”ç”¨èƒ½å¤Ÿåœ¨**ç³»ç»Ÿä»£ç†æ¨¡å¼**ä¸‹é€šè¿‡ Cloudflare éªŒè¯ï¼Œæ— éœ€ä½¿ç”¨ TUN æ¨¡å¼ã€‚

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. WebRTC IP æ³„éœ²ä¿æŠ¤ â­â­â­â­â­

**é—®é¢˜**ï¼šWebRTC ä¼šç»•è¿‡ä»£ç†ç›´æ¥æš´éœ²æœ¬åœ° IP åœ°å€

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ‹¦æˆª `RTCPeerConnection` åˆ›å»º
- æ¸…ç©ºæ‰€æœ‰ ICE æœåŠ¡å™¨é…ç½®
- å¼ºåˆ¶ä½¿ç”¨ relay æ¨¡å¼
- è¿‡æ»¤åŒ…å«æœ¬åœ° IP çš„ candidate

**æ•ˆæœ**ï¼š
```javascript
// ä¹‹å‰ï¼šæ³„éœ²æœ¬åœ° IP
candidate: 192.168.1.100:54321 typ host

// ä¹‹åï¼šæ²¡æœ‰æœ¬åœ° IP
candidate: (æ—  candidate æˆ–ä»…å…¬ç½‘ IP)
```

### 2. æµè§ˆå™¨æŒ‡çº¹ä¿®æ”¹ â­â­â­â­â­

**é—®é¢˜**ï¼šWebView çš„æµè§ˆå™¨ç‰¹å¾å®¹æ˜“è¢«è¯†åˆ«ä¸ºè‡ªåŠ¨åŒ–å·¥å…·

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®æ”¹ User-Agent ä¸ºçœŸå® Chrome
- ä¿®æ”¹ platformã€vendor ç­‰å±æ€§
- éšè— webdriver æ ‡å¿—
- æ·»åŠ  chrome å¯¹è±¡
- æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨æ’ä»¶

**æ•ˆæœ**ï¼š
```javascript
// ä¹‹å‰ï¼š
navigator.webdriver = true
navigator.vendor = "Apple Computer, Inc."

// ä¹‹åï¼š
navigator.webdriver = undefined
navigator.vendor = "Google Inc."
```

### 3. Canvas æŒ‡çº¹ä¿æŠ¤ â­â­â­â­

**é—®é¢˜**ï¼šCanvas æ¸²æŸ“å¯ä»¥ç”Ÿæˆå”¯ä¸€æŒ‡çº¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨ toDataURL æ—¶æ·»åŠ å¾®å°å™ªå£°
- å™ªå£°åŸºäºåŸŸåç”Ÿæˆï¼ŒåŒä¸€ç½‘ç«™ä¸€è‡´
- ä¸å½±å“è§†è§‰æ•ˆæœ

**æ•ˆæœ**ï¼š
- æ¯ä¸ªåŸŸåçš„ Canvas æŒ‡çº¹ä¸åŒ
- åŒä¸€åŸŸåå†…æŒ‡çº¹ä¸€è‡´
- éš¾ä»¥è¢«è¿½è¸ª

### 4. WebGL æŒ‡çº¹ä¿æŠ¤ â­â­â­â­

**é—®é¢˜**ï¼šWebGL å¯ä»¥è·å–æ˜¾å¡ä¿¡æ¯ä½œä¸ºæŒ‡çº¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®æ”¹ UNMASKED_VENDOR_WEBGL
- ä¿®æ”¹ UNMASKED_RENDERER_WEBGL
- æ¨¡æ‹Ÿå¸¸è§æ˜¾å¡å‹å·

**æ•ˆæœ**ï¼š
```javascript
// ä¹‹å‰ï¼š
VENDOR: "Apple Inc."
RENDERER: "Apple M1 GPU"

// ä¹‹åï¼š
VENDOR: "Intel Inc."
RENDERER: "Intel(R) UHD Graphics 630"
```

### 5. æ—¶åŒºä¿®æ”¹ â­â­â­

**é—®é¢˜**ï¼šæ—¶åŒºä¸ä¸€è‡´ä¼šè¢«æ£€æµ‹

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä¿®æ”¹ getTimezoneOffset è¿”å› -480 (UTC+8)
- ä¿®æ”¹ Intl.DateTimeFormat è¿”å› Asia/Shanghai

**æ•ˆæœ**ï¼š
```javascript
// ç»Ÿä¸€æ—¶åŒºä¸ºä¸­å›½æ—¶åŒº
new Date().getTimezoneOffset() // -480
Intl.DateTimeFormat().resolvedOptions().timeZone // "Asia/Shanghai"
```

### 6. åª’ä½“è®¾å¤‡ç¦ç”¨ â­â­â­

**é—®é¢˜**ï¼šåª’ä½“è®¾å¤‡ä¿¡æ¯å¯ä»¥ä½œä¸ºæŒ‡çº¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¦ç”¨ getUserMedia
- ç¦ç”¨ enumerateDevices
- è¿”å›ç©ºè®¾å¤‡åˆ—è¡¨

**æ•ˆæœ**ï¼š
```javascript
// æ— æ³•è·å–æ‘„åƒå¤´ã€éº¦å…‹é£ç­‰è®¾å¤‡ä¿¡æ¯
navigator.mediaDevices.getUserMedia() // Permission denied
navigator.mediaDevices.enumerateDevices() // []
```

## ğŸ“Š æŠ€æœ¯å¯¹æ¯”

| æ£€æµ‹ç‚¹ | æœªä¿æŠ¤ | ä¿æŠ¤å | é‡è¦æ€§ |
|--------|--------|--------|--------|
| WebRTC IP | æœ¬åœ° IP æ³„éœ² | æ— æ³„éœ² | â­â­â­â­â­ |
| User-Agent | WebView ç‰¹å¾ | Chrome ç‰¹å¾ | â­â­â­â­â­ |
| Webdriver | true | undefined | â­â­â­â­â­ |
| Canvas æŒ‡çº¹ | å›ºå®š | åŠ¨æ€å™ªå£° | â­â­â­â­ |
| WebGL æŒ‡çº¹ | çœŸå®æ˜¾å¡ | æ¨¡æ‹Ÿæ˜¾å¡ | â­â­â­â­ |
| æ—¶åŒº | ç³»ç»Ÿæ—¶åŒº | ç»Ÿä¸€æ—¶åŒº | â­â­â­ |
| åª’ä½“è®¾å¤‡ | çœŸå®è®¾å¤‡ | æ— è®¾å¤‡ | â­â­â­ |

## ğŸ”§ é…ç½®é€‰é¡¹

åœ¨ `custom.js` ä¸­å¯ä»¥é…ç½®ï¼š

```javascript
const ANTI_DETECT_CONFIG = {
  enableWebRTCProtection: true,      // WebRTC ä¿æŠ¤
  enableFingerprintModification: true, // æŒ‡çº¹ä¿®æ”¹
  enableCanvasProtection: true,       // Canvas ä¿æŠ¤
  enableWebGLProtection: true,        // WebGL ä¿æŠ¤
  enableTimezoneModification: true,   // æ—¶åŒºä¿®æ”¹
  enableMediaDevicesBlock: true,      // åª’ä½“è®¾å¤‡ç¦ç”¨
  verbose: true                       // è¯¦ç»†æ—¥å¿—
};
```

### é…ç½®è¯´æ˜

- **enableWebRTCProtection**: æœ€é‡è¦ï¼Œé˜²æ­¢ IP æ³„éœ²
- **enableFingerprintModification**: æœ€é‡è¦ï¼Œæ¨¡æ‹ŸçœŸå®æµè§ˆå™¨
- **enableCanvasProtection**: é‡è¦ï¼Œé˜²æ­¢ Canvas æŒ‡çº¹è¿½è¸ª
- **enableWebGLProtection**: é‡è¦ï¼Œé˜²æ­¢ WebGL æŒ‡çº¹è¿½è¸ª
- **enableTimezoneModification**: ä¸­ç­‰ï¼Œç»Ÿä¸€æ—¶åŒº
- **enableMediaDevicesBlock**: ä¸­ç­‰ï¼Œé˜²æ­¢è®¾å¤‡æŒ‡çº¹
- **verbose**: å¼€å‘æ—¶å»ºè®® trueï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®® false

## ğŸ® ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šä½¿ç”¨å·²æ›´æ–°çš„æ–‡ä»¶

æ–‡ä»¶å·²è‡ªåŠ¨æ›´æ–°åˆ° `src-tauri/data/custom.js`ï¼Œç›´æ¥æ„å»ºå³å¯ï¼š

```bash
cd PakePlus-v212
pnpm run tauri:build
```

### æ–¹æ³• 2ï¼šå¼€å‘æ¨¡å¼æµ‹è¯•

```bash
cd PakePlus-v212
pnpm run tauri:dev
```

### æ–¹æ³• 3ï¼šæ‰‹åŠ¨æµ‹è¯•

1. æ‰“å¼€åº”ç”¨
2. å³é”® â†’ æ£€æŸ¥ â†’ æ‰“å¼€å¼€å‘è€…å·¥å…·
3. å¤åˆ¶ `æµ‹è¯•è„šæœ¬.js` çš„å†…å®¹
4. ç²˜è´´åˆ°æ§åˆ¶å°å¹¶å›è½¦
5. æŸ¥çœ‹æµ‹è¯•ç»“æœ

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### ç³»ç»Ÿä»£ç†æ¨¡å¼ä¸‹

**ä¹‹å‰**ï¼š
- âŒ æ— æ³•é€šè¿‡ Cloudflare éªŒè¯
- âŒ ä¸€ç›´æ˜¾ç¤º "Checking your browser"
- âŒ éœ€è¦åˆ‡æ¢åˆ° TUN æ¨¡å¼

**ä¹‹å**ï¼š
- âœ… å¯ä»¥é€šè¿‡ Cloudflare éªŒè¯
- âœ… æ­£å¸¸è®¿é—® lmarena.ai
- âœ… æ— éœ€åˆ‡æ¢åˆ° TUN æ¨¡å¼

### æ€§èƒ½å½±å“

- **å†…å­˜å¢åŠ **: < 5 MB
- **CPU å¢åŠ **: < 1%
- **å¯åŠ¨æ—¶é—´**: + 0.05s
- **è¿è¡Œæ—¶æ€§èƒ½**: å‡ ä¹æ— å½±å“

## ğŸ” éªŒè¯æ–¹æ³•

### å¿«é€ŸéªŒè¯

åœ¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—ï¼š

```
=== [AntiDetect] Cloudflare åæ£€æµ‹æ¨¡å—å¯åŠ¨ ===
[AntiDetect] âœ… RTCPeerConnection ä¿æŠ¤å·²å¯ç”¨
[AntiDetect] âœ… getUserMedia å·²ç¦ç”¨
[AntiDetect] âœ… æµè§ˆå™¨æŒ‡çº¹ä¿®æ”¹å®Œæˆ
[AntiDetect] âœ… Canvas æŒ‡çº¹ä¿æŠ¤å·²å¯ç”¨
[AntiDetect] âœ… WebGL æŒ‡çº¹ä¿æŠ¤å·²å¯ç”¨
[AntiDetect] âœ… æ—¶åŒºä¿®æ”¹å®Œæˆï¼ˆUTC+8ï¼‰
=== [AntiDetect] Cloudflare åæ£€æµ‹æ¨¡å—å¯åŠ¨å®Œæˆ ===
```

### å®Œæ•´æµ‹è¯•

å‚è€ƒ `åæ£€æµ‹æµ‹è¯•æŒ‡å—.md` è¿›è¡Œå®Œæ•´æµ‹è¯•ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä»£ç†é…ç½®

ç¡®ä¿ä»£ç†æ­£ç¡®é…ç½®ï¼š
- Clash Verge: ç³»ç»Ÿä»£ç†æ¨¡å¼ + æ­£ç¡®çš„ä»£ç†æœåŠ¡å™¨
- æ£€æŸ¥ä»£ç†æ˜¯å¦ç”Ÿæ•ˆï¼šè®¿é—® https://api.ipify.org

### 2. DNS é…ç½®

å¦‚æœä»ç„¶å¤±è´¥ï¼Œå¯èƒ½æ˜¯ DNS æ³„éœ²ï¼š
- åœ¨ Clash ä¸­å¯ç”¨ DNS åŠ«æŒ
- ä½¿ç”¨ fake-ip æ¨¡å¼

### 3. IP ä¿¡èª‰

å¦‚æœä»£ç†æœåŠ¡å™¨ IP ä¿¡èª‰å·®ï¼Œä»ç„¶å¯èƒ½è¢«æ‹¦æˆªï¼š
- æ›´æ¢ä»£ç†æœåŠ¡å™¨
- ä½¿ç”¨ä½å®… IP ä»£ç†

### 4. æµè§ˆå™¨ç¼“å­˜

é¦–æ¬¡ä½¿ç”¨æ—¶æ¸…é™¤ç¼“å­˜ï¼š
- å¼€å‘è€…å·¥å…· â†’ Network â†’ Disable cache
- æˆ–è€…ä½¿ç”¨éšç§æ¨¡å¼

## ğŸ› é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šåæ£€æµ‹æ¨¡å—æœªå¯åŠ¨

**ç—‡çŠ¶**ï¼šæ§åˆ¶å°æ²¡æœ‰ `[AntiDetect]` æ—¥å¿—

**è§£å†³**ï¼š
1. ç¡®è®¤ `custom.js` å·²æ›´æ–°
2. é‡æ–°æ„å»ºï¼š`pnpm run tauri:build`
3. æ¸…é™¤ç¼“å­˜åé‡å¯

### é—®é¢˜ 2ï¼šWebRTC ä»ç„¶æ³„éœ² IP

**ç—‡çŠ¶**ï¼šæµ‹è¯•è„šæœ¬æ˜¾ç¤ºæœ¬åœ° IP

**è§£å†³**ï¼š
1. æ£€æŸ¥ `enableWebRTCProtection` æ˜¯å¦ä¸º `true`
2. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ "æ‹¦æˆª RTCPeerConnection" æ—¥å¿—
3. å°è¯•å®Œå…¨ç¦ç”¨ WebRTCï¼ˆåœ¨é…ç½®ä¸­ï¼‰

### é—®é¢˜ 3ï¼šä»ç„¶æ— æ³•é€šè¿‡éªŒè¯

**ç—‡çŠ¶**ï¼šè®¿é—® lmarena.ai ä»ç„¶è¢«æ‹¦æˆª

**å¯èƒ½åŸå› **ï¼š
1. DNS æ³„éœ²
2. ä»£ç†é…ç½®é—®é¢˜
3. IP ä¿¡èª‰é—®é¢˜
4. å…¶ä»–æŒ‡çº¹ç‰¹å¾

**è§£å†³**ï¼š
1. è¿è¡Œå®Œæ•´æµ‹è¯•è„šæœ¬
2. æ£€æŸ¥æ‰€æœ‰æµ‹è¯•é¡¹æ˜¯å¦é€šè¿‡
3. æŸ¥çœ‹ `åæ£€æµ‹æµ‹è¯•æŒ‡å—.md` çš„é—®é¢˜æ’æŸ¥éƒ¨åˆ†

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `åæ£€æµ‹æµ‹è¯•æŒ‡å—.md` - è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤
- `æµ‹è¯•è„šæœ¬.js` - è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- `é…ç½®è¯´æ˜.md` - é…ç½®é¡¹è¯¦è§£
- `æ¶æ„è¯´æ˜.md` - æŠ€æœ¯æ¶æ„

## ğŸ¯ æœ€ä½³å®è·µ

1. **å¼€å‘é˜¶æ®µ**ï¼š
   - å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼ˆ`verbose: true`ï¼‰
   - ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯
   - ç›‘æ§æ§åˆ¶å°è¾“å‡º

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼š
   - å…³é—­è¯¦ç»†æ—¥å¿—ï¼ˆ`verbose: false`ï¼‰
   - å®šæœŸæµ‹è¯•éªŒè¯
   - æ”¶é›†ç”¨æˆ·åé¦ˆ

3. **é—®é¢˜å¤„ç†**ï¼š
   - è®°å½•å¤±è´¥æ¡ˆä¾‹
   - åˆ†æå¤±è´¥åŸå› 
   - æŒç»­ä¼˜åŒ–é…ç½®

## ğŸš€ æœªæ¥ä¼˜åŒ–

å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘ï¼š

1. **åŠ¨æ€æŒ‡çº¹**ï¼šæ ¹æ®è®¿é—®çš„ç½‘ç«™åŠ¨æ€è°ƒæ•´æŒ‡çº¹
2. **æ›´å¤šä¿æŠ¤**ï¼šæ·»åŠ  AudioContextã€Font ç­‰æŒ‡çº¹ä¿æŠ¤
3. **æ™ºèƒ½æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶åº”å¯¹æ–°çš„æ£€æµ‹æ‰‹æ®µ
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ€§èƒ½å¼€é”€
5. **é…ç½®ç•Œé¢**ï¼šæä¾›å›¾å½¢åŒ–é…ç½®ç•Œé¢

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ `åæ£€æµ‹æµ‹è¯•æŒ‡å—.md`
2. è¿è¡Œ `æµ‹è¯•è„šæœ¬.js`
3. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—
4. æä¾›å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š

---

**ç‰ˆæœ¬**: 1.1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-11-17  
**ä½œè€…**: Kiro AI Assistant

**ç¥ä½¿ç”¨é¡ºåˆ©ï¼** ğŸ‰
